<Window x:Class="PersonalFinance.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:PersonalFinance.Wpf.ViewModels"
        xmlns:domain="clr-namespace:PersonalFinance.Domain"
        Title="Личные финансы" Height="600" Width="1100">
    <Grid Margin="8">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="280"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Левая панель -->
        <StackPanel Grid.Column="0" Margin="0,0,8,0">
            <Button Content="Seed" Width="100" Margin="0 0 0 8"
                    Command="{Binding SeedCommand}"/>
            <ListBox ItemsSource="{Binding Wallets}" SelectedItem="{Binding SelectedWallet}">
                <ListBox.ItemTemplate>
                    <DataTemplate DataType="{x:Type vm:WalletViewModel}">
                        <StackPanel>
                            <TextBlock FontWeight="Bold" Text="{Binding Name}"/>
                            <TextBlock Text="{Binding Currency}"/>
                            <TextBlock Text="{Binding CurrentBalance, StringFormat=Баланс: {0:F2}}"/>
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </StackPanel>

        <!-- Правая панель -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Месяц -->
            <StackPanel Orientation="Horizontal" Margin="0 0 0 8">
                <TextBlock Text="Месяц:" VerticalAlignment="Center" Margin="0 0 6 0"/>
                <DatePicker SelectedDate="{Binding SelectedMonth}"/>
            </StackPanel>

            <!-- Новая транзакция -->
            <GroupBox Header="Новая транзакция" Grid.Row="1" Margin="0 0 0 8">
                <StackPanel Orientation="Horizontal" Margin="8">
                    <DatePicker SelectedDate="{Binding NewDate}" Width="140"/>
                    <!-- ComboBox типа -->
                    <ComboBox Width="120" Margin="8 0 0 0"
              SelectedValue="{Binding NewType}" SelectedValuePath="Tag">
                        <ComboBoxItem Content="Income"  Tag="{x:Static domain:TransactionType.Income}"/>
                        <ComboBoxItem Content="Expense" Tag="{x:Static domain:TransactionType.Expense}"/>
                    </ComboBox>
                    <TextBox Width="120" Margin="8 0 0 0"
             Text="{Binding NewAmount, UpdateSourceTrigger=PropertyChanged}"/>
                    <TextBox Width="240" Margin="8 0 0 0"
             Text="{Binding NewDescription}"/>

                    <!-- ВОТ ЭТА КНОПКА -->
                    <Button Content="Добавить"
            Width="100" Margin="8 0 0 0"
            Command="{Binding AddTransactionCommand}"/>
                </StackPanel>
            </GroupBox>

            <!-- Отчёты -->
            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <GroupBox Header="Группы по типу (месяц)" Margin="0 0 8 0">
                    <ItemsControl ItemsSource="{Binding MonthlyGroups}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Margin="6">
                                    <TextBlock FontWeight="Bold" Text="{Binding Type}"/>
                                    <TextBlock Text="{Binding Total, StringFormat=Итого: {0:F2}}"/>
                                    <DataGrid ItemsSource="{Binding Items}" AutoGenerateColumns="False">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Binding="{Binding Date, StringFormat=d}" Header="Дата"/>
                                            <DataGridTextColumn Binding="{Binding Amount, StringFormat=F2}" Header="Сумма"/>
                                            <DataGridTextColumn Binding="{Binding Description}" Header="Описание"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </GroupBox>

                <GroupBox Header="ТОП-3 трат (месяц)" Grid.Column="1">
                    <DataGrid ItemsSource="{Binding Top3Expenses}" AutoGenerateColumns="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Binding="{Binding Date, StringFormat=d}" Header="Дата"/>
                            <DataGridTextColumn Binding="{Binding Amount, StringFormat=F2}" Header="Сумма"/>
                            <DataGridTextColumn Binding="{Binding Description}" Header="Описание"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </GroupBox>
            </Grid>
        </Grid>
    </Grid>
</Window>
